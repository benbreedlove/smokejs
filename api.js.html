<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Smoke Docs Source: api.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cyborg.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Smoke Docs</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-Ad.html">Ad</a>
						</li>
						
						<li>
							<a href="module-api.html">api</a>
						</li>
						
						<li>
							<a href="module-edit_api.html">edit_api</a>
						</li>
						
						<li>
							<a href="module-edit_views.html">edit_views</a>
						</li>
						
						<li>
							<a href="module-editor.html">editor</a>
						</li>
						
						<li>
							<a href="module-main.html">main</a>
						</li>
						
						<li>
							<a href="module-markdown.html">markdown</a>
						</li>
						
						<li>
							<a href="module-render.html">render</a>
						</li>
						
						<li>
							<a href="module-router.html">router</a>
						</li>
						
						<li>
							<a href="module-views.html">views</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-api.Component.html">api.Component</a>
						</li>
						
						<li>
							<a href="module-api.Data.html">api.Data</a>
						</li>
						
						<li>
							<a href="module-edit_api.Component.html">edit_api.Component</a>
						</li>
						
						<li>
							<a href="module-edit_api.Data.html">edit_api.Data</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: api.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/* global document */
'use strict';
var EnvConfig = require('./config');
var request = require('browser-request');
var Promise = require('promise-polyfill');
var _ = require('lodash');

/**
 * Currently, a component object with a get function
 * @module api
 */

/**
 * Creates a callback function for server requests
 * @param {function} resolve - called with response if response is ok
 * @param {function} reject - called with response if response is not ok
 * @param {function} callback - callback is called with server response body if status ok
 * @returns {function} The function to be called after update or create requests
 */
exports._success = function(resolve, reject, callback) {
  var cb = callback ? callback : function() {};
  return function(err, result, body) {
    if (result.statusCode == 200) {
      try {
        cb(body);
      } catch(e) {
        reject(e);
        return;
      }
      resolve(result);
    } else if (result.statusCode == 401) {
      //redirect to log in server
      exports.logInRedirect();
    } else {
      EnvConfig.log(result);
      EnvConfig.ERROR_HANDLER(err);
      reject(result);
    }
  };
};

/**
 * Basic function for chaining requests and promises.
 * @param {args} - arguments passed to request
 * @param {callback} - callback will be called with body of response
 * @param {pull} - ignore ControlCache, currently unused.
 * @return {promise} - returns promise
 */
exports._promise_request = function(args, callback, pull) {
  var promise = new Promise(function(resolve, reject) {
    request(args, exports._success(resolve, reject, callback));
  });
  return promise;
};

/**
 * Data constructor
 * @class
 * @param {string} data_uri - URI of the data object
 */
exports.Data = function(data_uri) {
  /**
   * uri {uri} - the location of the data on the server
   * @inner
   */
  this.uri = data_uri;
  /**
   * url {url} - the full location of the data on the server
   * @inner
   */
  this.url = EnvConfig.MIRRORS_DOMAIN + data_uri;
};

/**
 * Gets the data from the server.
 * @param callback - Runs after data is returned.
 * @returns {promise}
 */
exports.Data.prototype.get = function(callback) {
  var self = this;
  var cb = function(data) {
    self.data = data;
    if (callback) { callback(data); };
  };
  return exports._promise_request(this.url, cb);
};

/**
 * Component constructor
 * @class
 * @param {string} - slug the id of the componet
 */
exports.Component = function(slug, data) {
  /**
   * slug {string} - the identifier of the component
   * @inner
   */
  this.slug = slug;
  /**
   * attributes {dictionary} - all the subsidiary components attached to a component
   * @inner
   */
  this.attributes = {};
  /**
   * metadata {dictionary} - additional information about the component
   * @inner
   */
  this.metadata = {};
  /**
   * content_type {string} - the type of content this component's data is (markdown, image, etc)
   * @inner
   */
  this.content_type = null;
  /**
   * schema_name {string} - the schema used to validat this is correct, and the template to use while rendering if this is the main content of a page
   * @inner
   */
  this.schema_name = null;
  /**
   * uri {url} - the location of the component for server gets and to display as a page on smoke
   * @inner
   */
  this.uri = null;
  /**
   * data_uri {url} - the location of the component's data
   * @inner
   */
  this.data_uri = null;
  /**
   * data {Data} - the data of the component
   * @inner
   */
  this.data = null;
  if (data) {
    this._build(data);
  }
};

/**
 * Interally binds the appropiate data constructor
 * to the component.
 */
exports.Component.prototype._Data = exports.Data;

/**
 * Internal function for building attrbitutes and metadata
 * from a Components response.
 */
exports.Component.prototype._build = function(data) {
  this.metadata = data.metadata;
  this.content_type = data.content_type;
  this.schema_name = data.schema_name;
  this.data_uri = data.data_uri;
  this.uri = data.uri;
  /**
   * points to the Data object for Component instance
   */
  this.data = new this._Data(data.data_uri);
  for (var attr in data.attributes) {
    var attribute = data.attributes[attr];
    //is it an array?
    if (_.isArray(attribute)) {
      this.attributes[attr] = [];
      for (var i = 0; i &lt; attribute.length; i++) {
        this.attributes[attr].push(
          new exports.Component(attribute[i].slug, attribute[i])
        );
      }
    } else {
      this.attributes[attr] = new exports.Component(attribute.slug, attribute);
    }
  }
};

/**
 * Checks localstorage for the component's data, calls out to server if
 * localstorage doesn't have it or is stale
 * @function
 * @param {function} callback - is called after the GET request for the component completes with the JSON as the first argument
 * @param {boolean} pull - don't check local storage, pull from server
 * @returns {promise} resolves after the callback is complete, fails on error
 */
exports.Component.prototype.get = function(callback, pull) {
  var self = this;
  return exports._promise_request(EnvConfig.MIRRORS_URL + 'component/' + self.slug + '/',
    function(body) {
      var data = JSON.parse(body);
      self._build(data);
      if (callback) {callback(self);};
    }
  );
};

/**
 * Redirects browser to mirrors log in page
 * @memberof module:api
 */
exports.logInRedirect = function() {
  document.location = EnvConfig.MIRRORS_DOMAIN +
    '/login?request=' + encodeURI(document.location);
};
</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		MotherJones Copyright Â© 2012-2014
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Wed Jul 30th 2014 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
